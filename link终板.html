<!DOCTYPE html>
<html style="height: 100%">
   <head>
       <meta charset="utf-8">
   </head>
   <style type="text/css">
   .fade{
    position:relative;
    z-index:10;
    background-color:rgba(255,255,255,0.5)
   }
   .fade2{
    position:relative;
    z-index:10;
    background-color:rgba(255,255,255)
   }
   </style>
   <body style="width:100%;height: 60%; margin: 0">
       <div id = "filter_kw" style = "width:15%;height:100%;overflow:auto;float:left;position:relative;z-index:10;background-color:rgba(255,255,255,1)">
        Select keyword:<br>
        <p><input type="checkbox" name="category" value="visualization"/>visualization </p>
		<p><input type="checkbox" name="category" value="analysis"/>analysis </p>
		<p><input type="checkbox" name="category" value="data"/>data </p>
		<p><input type="checkbox" name="category" value="information"/>information </p>
		<p><input type="checkbox" name="category" value="time"/>time </p>
		
		<p><input type="checkbox" name="category" value="topic"/>topic </p>
		<p><input type="checkbox" name="category" value="model"/>model </p>
		<p><input type="checkbox" name="category" value="view"/>view </p>
		<p><input type="checkbox" name="category" value="social"/>social </p>
		<p><input type="checkbox" name="category" value="cluster"/>cluster </p>
		
		<p><input type="checkbox" name="category" value="map"/>map </p>
		<p><input type="checkbox" name="category" value="patterns"/>patterns </p>
		<p><input type="checkbox" name="category" value="traffic"/>traffic </p>
		<p><input type="checkbox" name="category" value="flow"/>flow </p>
		<p><input type="checkbox" name="category" value="layout"/>layout </p>
		
		<p><input type="checkbox" name="category" value="learning"/>learning </p>
		<p><input type="checkbox" name="category" value="road"/>road </p>
		<p><input type="checkbox" name="category" value="text"/>text </p>
		<p><input type="checkbox" name="category" value="clustering"/>clustering </p>
		<p><input type="checkbox" name="category" value="design"/>design </p>
		
		<p><input type="checkbox" name="category" value="graph"/>graph </p>
		<p><input type="checkbox" name="category" value="media"/>media </p>
		<p><input type="checkbox" name="category" value="network"/>network </p>
		<p><input type="checkbox" name="category" value="related"/>related </p>
		<p><input type="checkbox" name="category" value="relationships"/>relationships </p>
		
		<p><input type="checkbox" name="category" value="series"/>series </p>
		<p><input type="checkbox" name="category" value="taxi"/>taxi </p>
		<p><input type="checkbox" name="category" value="temporal"/>temporal </p>
		<p><input type="checkbox" name="category" value="tree"/>tree </p>
		<p><input type="checkbox" name="category" value="trend"/>trend </p>
		
		<p><input type="checkbox" name="category" value="word"/>word </p>
		<p><input type="checkbox" name="category" value="behaviors"/>behaviors </p>
		<p><input type="checkbox" name="category" value="content"/>content </p>
		<p><input type="checkbox" name="category" value="course"/>course </p>
		<p><input type="checkbox" name="category" value="documents"/>documents </p>
		
		<p><input type="checkbox" name="category" value="evolution"/>evolution </p>
		<p><input type="checkbox" name="category" value="feature"/>feature </p>
		<p><input type="checkbox" name="category" value="hierarchical"/>hierarchical </p>
		<p><input type="checkbox" name="category" value="interactions"/>interactions </p>
		<p><input type="checkbox" name="category" value="keyword"/>keyword </p>
		
		<p><input type="checkbox" name="category" value="layer"/>layer </p>
		<p><input type="checkbox" name="category" value="layers"/>layers </p>
		<p><input type="checkbox" name="category" value="MOOC"/>MOOC </p>
		<p><input type="checkbox" name="category" value="graphs"/>graphs </p>
		<p><input type="checkbox" name="category" value="news"/>news </p>
		
		<p><input type="checkbox" name="category" value="online"/>online </p>
		<p><input type="checkbox" name="category" value="opinion"/>opinion </p>
		<p><input type="checkbox" name="category" value="public"/>public </p>
		<p><input type="checkbox" name="category" value="route"/>route </p>
		<p><input type="checkbox" name="category" value="spatial"/>spatial </p>
		
		<p><input type="checkbox" name="category" value="topics"/>topics </p>
		<p><input type="checkbox" name="category" value="trajectories"/>trajectories </p>
		<p><input type="checkbox" name="category" value="trajectory"/>trajectory </p>
		<p><input type="checkbox" name="category" value="urban"/>urban </p>
		<p><input type="checkbox" name="category" value="aggregation"/>aggregation </p>
		
		
		<p><input type="checkbox" name="category" value="area"/>area </p>
		<p><input type="checkbox" name="category" value="behavior"/>behavior </p>
		<p><input type="checkbox" name="category" value="clouds"/>clouds </p>
		<p><input type="checkbox" name="category" value="color"/>color </p>
		<p><input type="checkbox" name="category" value="competition"/>competition </p>
		
		<p><input type="checkbox" name="category" value="context"/>context </p>
		<p><input type="checkbox" name="category" value="corpora"/>corpora </p>
		<p><input type="checkbox" name="category" value="cut"/>cut </p>
		<p><input type="checkbox" name="category" value="deep"/>deep </p>
		<p><input type="checkbox" name="category" value="density"/>density </p>
		
		<p><input type="checkbox" name="category" value="diffusion"/>diffusion </p>
		<p><input type="checkbox" name="category" value="document"/>document </p>
		<p><input type="checkbox" name="category" value="edge"/>edge </p>
		<p><input type="checkbox" name="category" value="leaders"/>leaders </p>
		<p><input type="checkbox" name="category" value="mining"/>mining </p>
		
		<p><input type="checkbox" name="category" value="mobility"/>mobility </p>
		<p><input type="checkbox" name="category" value="neurons"/>neurons </p>
		<p><input type="checkbox" name="category" value="optimization"/>optimization </p>
		<p><input type="checkbox" name="category" value="process"/>process </p>
		<p><input type="checkbox" name="category" value="propagation"/>propagation </p>
		
		<p><input type="checkbox" name="category" value="ranking"/>ranking </p>
		<p><input type="checkbox" name="category" value="region"/>region </p>
		<p><input type="checkbox" name="category" value="routes"/>routes </p>
		<p><input type="checkbox" name="category" value="semantic"/>semantic </p>
		<p><input type="checkbox" name="category" value="storyline"/>storyline </p>
		
		<p><input type="checkbox" name="category" value="streaming"/>streaming </p>
		<p><input type="checkbox" name="category" value="tag"/>tag </p>
		<p><input type="checkbox" name="category" value="timeline"/>timeline </p>
		<p><input type="checkbox" name="category" value="training"/>training </p>
		<p><input type="checkbox" name="category" value="transportation"/>transportation </p>
		
		<p><input type="checkbox" name="category" value="trends"/>trends </p>
		<p><input type="checkbox" name="category" value="tweets"/>tweets </p>
		<p><input type="checkbox" name="category" value="uncertainty"/>uncertainty </p>      
         
        <p><input id="btnOperate" type="button" value="submit" onclick="static_num()" /></p>
        <p><input id="btnOperate" type="button" value="recover" onclick="recover()" /></p>
       </div>
       <div id="container3" style="height: 100%;width:0%;float:right;overflow:auto;">
       </div>
       <div id="container" style="width: 100%;height:80%;position:absolute;"></div>
       <div style="clear:both;"></div>
      <div id="container4" style="height: 40%;width:15%;float:left;position:relative;z-index:10;background-color:rgba(255,255,255,1)">
        <p>Content<input type="range" id = "controlValue" name="points" min="0" max="1000" step = "1" /></p>
        <p>Keyword<input type="range" id = "controlKeyword" name="points" min="0" max="1000" step = "1" /></p>
        <p>Attribute<input type="range" id = "controlAttribute" name="points" min="0" max="1000" step = "1" /></p>
        <p><input type="checkbox" name="options" value="authors"/>authors</p>
        <p><input type="checkbox" name="options" value="authors_affiliations"/>authors affiliations</p>
        <p><input type="checkbox" name="options" value="publication_title"/>publication_title</p>
        <p><button onclick="controlSimilarity()">submit</button><button onclick="recover()">recover</button></p>
      </div>
       <div id="container2" style="height: 60%;width:80%;float:left;position:relative;z-index:10;background-color:rgba(255,255,255,1);margin-top:0%;"></div>

       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
       <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
       <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="./numeric-1.2.6.min.js"></script>
       <script type="text/javascript">

var dom = document.getElementById("container");
var myChart = echarts.init(dom);
var dom2 = document.getElementById("container2");
var mySecondChart = echarts.init(dom2);
var dom3 = document.getElementById("container3");
var mythirdChart = echarts.init(dom3);
var app = {};
//------------------
var used_graph_links = [];
var used_graph_nodes = [];

var origin_graph_links = [];
var origin_graph_nodes = [];
//------------------
option = null;
myChart.showLoading();
mySecondChart.showLoading();
mythirdChart.showLoading()
var graph;
$.getJSON('data_1023.json', function (json) {
  myChart.hideLoading();
  mySecondChart.hideLoading();
  mythirdChart.hideLoading();
  graph = json;
  var cnt = 0;
  // for(i = 0; i < graph.rlinks.length; i++){
  //   if(graph.rlinks[i].value > 0.45){
  //     cnt = cnt + 1;
  //     used_graph_links.push(graph.rlinks[i]);
  //   }
  // }
  // console.log(cnt);
  // console.log(used_graph_links.length);
  used_graph_links = deepClone(graph.links);
  used_graph_nodes = deepClone(graph.rnodes);

  var a = 0.5;
  var b = 0.5;
  var c = 0.5;

  var link_length = used_graph_links.length;
  var node_length = used_graph_nodes.length;
  var D = new Array();
  for(i = 0; i < node_length; i++){
    D[i] = new Array();
    for(j = 0; j < node_length; j++){
      D[i][j] = 0;
    }
  }
  for(i = 0; i < node_length; i++){
    for(j = 0; j < node_length; j++){
      for(k = 0; k < graph.rlinks.length; k++){
        if((paperDic[i] == graph.rlinks[k].source && paperDic[j] == graph.rlinks[k].target) || (paperDic[i] == graph.rlinks[k].target && paperDic[j] == graph.rlinks[k].source)){
            D[i][j] = a * graph.rlinks[k].value_sm + b * graph.rlinks[k].value_kw + c * (graph.rlinks[k].value_at_aa + graph.rlinks[k].value_at_al + graph.rlinks[k].value_at_p)/3;
            D[j][i] = D[i][j];
            graph.rlinks[k].value = D[j][i];
        }
      }
    }
  }
  // console.log(D);
  var X = mds(D,2);
  // console.log(X);
  for(i = 0; i < node_length; i++){
    X[i][0] = X[i][0] * 1920 * 3 + 1920;
    X[i][1] = X[i][1] * 1080 * 3 + 1080;
  }
  var new_X = prevent_crash(X,80,node_length);
  for(i = 0; i < node_length; i++){
    used_graph_nodes[i].x = new_X[i][0];
    used_graph_nodes[i].y = new_X[i][1];
  }
  console.log(new_X);
  origin_graph_nodes = deepClone(used_graph_nodes);
  origin_graph_links = deepClone(used_graph_links);
  //alert("1");
  var m = new Map();
    for(var i = 0; i < graph.nodes.length; i++)
    {
      var key = graph.nodes[i].name;
      var value = graph.nodes[i].des;
      m.set(key,value);
    }

  option = 
  {
    tooltip: {
      formatter: function (x) {
        return x.data.des;
      }
    },

    series: 
    [
      {
        type: 'graph',
        layout: 'none',
        symbolSize: 70,
        roam: true,
        edgeSymbol: ['circle', 'none'],  
        //后者改为none箭头可消失，改为arrow有箭头
        edgeSymbolSize: [1, 8],
        edgeLabel: {
          normal: {
            textStyle: {
              fontSize: 20
            }
          }
        },
   
      //   force: {
      //       //repulsion: 5500,
						// repulsion: [1,2000],
      //       edgeLength: [1, 500]
      //   },
        
        draggable: true,
				focusNodeAdjacency: true,  //悬浮，与其相关的节点都会highlight

        itemStyle: {
          emphasis: {
            color: '#EAC100'
          }
        },

        lineStyle: {
          normal: {
            width: 0,   //值为0不显示线
            color: '#3C3C3C',
            opacity: 0.4
          },
        },
        
        edgeLabel: {
          normal: {
            show: false,  //显示线上文字
            formatter: function (x) {
              return x.data.name;
            },
						textStyle: {
						  fontSize: 13,
            }
          }
        },

        label: {
          normal: {
            show: true,  //换成词云后  这个可以改成false   不显示数字
            textStyle: {
							fontSize: 10
            }
          },
  		    emphasis:{
  		      show:false  //****true高亮显示数字编号，正式论文false不显示
            
  	      }
        },
        data: used_graph_nodes,
        links: used_graph_links,
        emphasis: {
                lineStyle: {
                    width: 5,
                    color: '#080808',
                    opacity:1
                }
            }
      }


    ]
  };
    myChart.setOption(option);
    var papers = [];
        var papers2 = [];
        var paper_no_similarity = [];
        var a = document.getElementById("controlValue").value / 1000;
        var b = document.getElementById("controlKeyword").value / 1000;
        var c = document.getElementById("controlAttribute").value / 1000;
        myChart.on("click", function (param){  
          //交互功能0
          // $("#container3").addClass("fade2");
          //$("#container2").addClass("fade");
          // var nowid = param.name;
          // var len = graph.path.length;
          // nowdata = [];
          // nowlink = [];
          // console.log(nowid);
          // for(i = 0; i < len; i++)
          // {
          //   if(graph.path[i].id == nowid){
          //     console.log(graph.path[i]);
          //     var dasb = graph.path[i];
          //     pathh = dasb.path.split(" ");

          //     for(j = 0; j < pathh.length-1; j++){
          //       var nid = pathh[j];
          //       console.log(nid);
          //       for(k = 0; k < graph.nodes.length; k++){
          //         if(graph.nodes[k].name == nid){
          //           nowdata.push(graph.nodes[k]);
          //           break;
          //         }
          //       }
          //       if(j < pathh.length - 1){
          //         var nid2 = pathh[j+1];
          //         for(k = 0; k < graph.rlinks.length; k++){
          //           if(graph.rlinks[k].source == nid && graph.rlinks[k].target == nid2){
          //             nowlink.push(graph.rlinks[k]);
          //             break;
          //           }
          //           if(graph.rlinks[k].target == nid && graph.rlinks[k].source == nid2){
          //             var str = graph.rlinks[k].name.split(" ");
          //             var name = "";
          //             for(i = str.length - 1; i >= 0; i--){
          //               name = name + "  " + str[i];
          //             }
          //             var temp = {
          //               "source": graph.rlinks[k].target,
          //               "target": graph.rlinks[k].source,
          //               "name": name,
          //               "value": graph.rlinks[k].value,
          //               "value_sm": graph.rlinks[k].value_sm,
          //               "value_kw": graph.rlinks[k].value_kw,
          //               "value_at": graph.rlinks[k].value_at
          //             };
          //             // var sb = deepClone(temp.source);
          //             // temp.target = temp.source;
          //             // temp.source = sb;
          //             nowlink.push(temp);
          //             break;
          //           }
          //         }
          //       }

          //     }
          //     break;
          //   }
          // }
          // for(ii = 0; ii < nowlink.length; ii++){
          //   nowlink[ii].value = 1;
          // }
          // console.log(nowdata);
          // console.log(nowlink);
          // option250 = {
          //   tooltip: {
          //     formatter: function (x) {
          //       return x.data.des;
          //     }
          //   },

          //   series: 
          //   [
          //     {
          //       type: 'graph',
          //       layout: 'force',
          //       symbolSize: 90,
          //       roam: true,
          //       edgeSymbol: ['circle', 'arrow'],  
          //       //后者改为none箭头可消失，改为arrow有箭头
          //       edgeSymbolSize: [1, 8],
          //       edgeLabel: {
          //         normal: {
          //           textStyle: {
          //             fontSize: 20
          //           }
          //         }
          //       },

          //       force: {
          //           //repulsion: 5500,
          //           repulsion: 5000 ,
          //           edgeLength: 500
          //       },
                
          //       draggable: true,
          //       focusNodeAdjacency: true,  //悬浮，与其相关的节点都会highlight

          //       itemStyle: {
          //         emphasis: {
          //           color: '#EAC100'
          //         }
          //       },

          //       lineStyle: {
          //         normal: {
          //           width: 1,   //值为0不显示线
          //           color: '#3C3C3C',
                    
          //           curveness: 0.2
          //         }
          //       },
                
          //       edgeLabel: {
          //         normal: {
          //           show: true,  //显示线上文字
          //           formatter: function (x) {
          //             return x.data.name;
          //           },

          //           textStyle: {
          //             fontSize: 20,
          //           }
          //         }
          //       },

          //       label: {
          //         normal: {
          //           show: false,  //换成词云后  这个可以改成false   不显示数字
          //           textStyle: {
          //             fontSize: 10
          //           }
          //         },
          //     emphasis:{
          //         show:false  //****true高亮显示数字编号，正式论文false不显示
          //       }
          //       },
          //       data: nowdata,
          //       links: nowlink,
          //     }

          //   ]
          // };
          // mythirdChart.setOption(option250);
          //交互功能1
          if(param.name.search(">") == -1 && param.name.search("<") == -1){
          //papers = "";
          papers.splice(0, papers.length);
          papers2.splice(0, papers.length);
          paper_no_similarity.splice(0, paper_no_similarity.length); 
          console.log(used_graph_links.length);  
          console.log(param.name);       
          for(var i = 0; i < used_graph_links.length; i ++)
          {
            if(used_graph_links[i].source == param.name){
              var tempvalue = 0;
              var sc = used_graph_links[i].source;
              var tg = used_graph_links[i].target;
              for(j = 0; j < graph.rlinks.length; j++){
                if((graph.rlinks[j].source == sc && graph.rlinks[j].target == tg) || (graph.rlinks[j].target == sc && graph.rlinks[j].source == tg)){
                    tempvalue = graph.rlinks[j].value;
                    break;
                }
              }
              papers.push(used_graph_links[i].target);
              paper_no_similarity.push(tempvalue);
            }
          
          } 
          for(var i = 0; i < used_graph_links.length; i ++)
          {
              if(used_graph_links[i].target == param.name){
                var tempvalue = 0;
                var sc = used_graph_links[i].source;
                var tg = used_graph_links[i].target;
                for(j = 0; j < graph.rlinks.length; j++){
                  if((graph.rlinks[j].source == sc && graph.rlinks[j].target == tg) || (graph.rlinks[j].target == sc && graph.rlinks[j].source == tg)){
                      tempvalue = graph.rlinks[j].value;
                      break;
                  }
                }
              papers2.push(used_graph_links[i].source);
              paper_no_similarity.push(tempvalue);
            }
          
          }  
          console.log(paper_no_similarity.length);
          //alert(papers.length);
          option1 = {
          title: {
            text: 'References of this paper',
          },
          tooltip: {
              trigger: 'axis',
              axisPointer: {
                  type: 'shadow'
              }
          },
          legend: {
              type:"scroll",
          },
          grid: {
            left: '1%',
            right: '1%',
            bottom: '1%',
            containLabel: true
          },
          xAxis: {
              type: 'value',
              boundaryGap: [0, 0.01]
          },
          yAxis: {
              type: 'category',
              data: (function(){
                var res = [];
                var len = 0;
                var finalLen = papers.length;
                while(len++ < finalLen){
                  dataa = papers.shift() + "";
                  //alert(dataa);
                  dataa = m.get(dataa);
                  res.push(
                    dataa,
                  );

                }
                len = 0;
                finalLen = papers2.length;
                while(len++ < finalLen){
                  dataa = papers2.shift() + "";
                  //alert(dataa);
                  dataa = m.get(dataa);
                  res.push(
                    dataa,
                  );

                }
                return res;
              })()
          },
          series: [
              {
                  name: 'value',
                  type: 'bar',
                  data: (function(){
                    var res = [];
                    var len = 0;
                    var finalLen = paper_no_similarity.length
                    while(len++ < finalLen){
                      datab = paper_no_similarity.shift();
                      res.push(
                        datab,
                      );

                    }

                    return res;
                  })()
              },
          ]
        };

          mySecondChart.setOption(option1);
        }
          //alert(datas);
          //alert(param.dataIndex+':'+option.series[0].data[param.dataIndex].name);
        });
});

var paperDic = [2,3,5,7,8,10,11,13,14,15,16,17,18,19,21,23,25,27,28,32,35,37,44,45,53,60,63,65,67,71,75,81,84,86,94,97,114,118,121,124,125,126];

function mds(distances, dimensions) {
    dimensions = dimensions || 2;

    // square distances
    var M = numeric.mul(-0.5, numeric.pow(distances, 2));

        // double centre the rows/columns
    function mean(A) { return numeric.div(numeric.add.apply(null, A), A.length); }
    var rowMeans = mean(M),
        colMeans = mean(numeric.transpose(M)),
        totalMean = mean(rowMeans);

    for (var i = 0; i < M.length; ++i) {
        for (var j =0; j < M[0].length; ++j) {
            M[i][j] += totalMean - rowMeans[i] - colMeans[j];
        }
    }

    // take the SVD of the double centred matrix, and return the
    // points from it
    var ret = numeric.svd(M),
        eigenValues = numeric.sqrt(ret.S);
    return ret.U.map(function(row) {
        return numeric.mul(row, eigenValues).splice(0, dimensions);
    });
}

function is_intersect(x1,y1,x2,y2,radius){
  if(Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2) ) < (radius * 2)){
    return true;
  }
  return false;
}
//弹簧算法
function prevent_crash(X,radius,node_length){
    for(i = 0; i < node_length; i++){
      var initial_x = X[i][0];
      var initial_y = X[i][1];
      var is_intersect_flag = 1;
      var start_angle = 0;
      var start_radius = radius;
      while(is_intersect_flag == 1){
        is_intersect_flag = 0;
        for(j = 0; j < i;j++){
          var now_x = X[j][0];
          var now_y = X[j][1];
          if(is_intersect(initial_x,initial_y,now_x,now_y,radius) == true){
            is_intersect_flag = 1;
            initial_x = initial_x + start_radius * Math.cos(start_angle/180 * Math.PI);
            initial_y = initial_y + start_radius * Math.sin(start_angle/180 * Math.PI);
            break;
          }
        }

        if(is_intersect_flag == 1){
          if(start_angle >= 360){
            start_angle = 0;
            start_radius = start_radius + 20;
          }
          start_angle = Math.random() * 360 + start_angle;
        }
      }
      // console.log("XY");
      // console.log(initial_x);
      // console.log(initial_y);
      X[i][0] = initial_x;
      X[i][1] = initial_y;
    }
    return X;
}

function controlSimilarity(){
  var a = document.getElementById("controlValue").value / 1000;
  var b = document.getElementById("controlKeyword").value / 1000;
  var c = document.getElementById("controlAttribute").value / 1000;
  var tempvalue = 0;
  var items = document.getElementsByName("options");
  // console.log(items[1].checked);
  var link_length = used_graph_links.length;
  var node_length = used_graph_nodes.length;
  var D = new Array();
  for(i = 0; i < node_length; i++){
    D[i] = new Array();
    for(j = 0; j < node_length; j++){
      D[i][j] = 0;
    }
  }
  for(i = 0; i < node_length; i++){
    for(j = 0; j < node_length; j++){
      for(k = 0; k < graph.rlinks.length; k++){
        if((paperDic[i] == graph.rlinks[k].source && paperDic[j] == graph.rlinks[k].target) || (paperDic[i] == graph.rlinks[k].target && paperDic[j] == graph.rlinks[k].source)){
          // console.log(graph.rlinks[k].value_at_aa);
            if(items[0].checked){
              if(graph.rlinks[k].value_at_al == 1){
                tempvalue += (1/3);
              }
            }
            if(items[1].checked){
              console.log(graph.rlinks[k].value_at_aa);
              if(graph.rlinks[k].value_at_aa == 1){
                tempvalue += (1/3);
              }
            }
            if(items[2].checked){
              if(graph.rlinks[k].value_at_p == 1){
                tempvalue += (1/3);
              }
            }
            D[i][j] = a * graph.rlinks[k].value_sm + b * graph.rlinks[k].value_kw + c * tempvalue;
            D[j][i] = D[i][j];
            graph.rlinks[k].value = D[j][i];
            tempvalue = 0;
        }
      }
    }
  }
  // console.log("D");
  // console.log(D);
  var X = mds(D,2);
  // console.log(X);
  for(i = 0; i < node_length; i++){
    X[i][0] = X[i][0] * 1920 * 3 + 1920;
    X[i][1] = X[i][1] * 1080 * 3 + 1080;
  }
  var new_X = prevent_crash(X,80,node_length);
  // console.log("NewX");
  // console.log(new_X);
  for(i = 0; i < node_length; i++){
    used_graph_nodes[i].x = new_X[i][0];
    used_graph_nodes[i].y = new_X[i][1];
  }
  option3 = {
    tooltip: {
      formatter: function (x) {
        return x.data.des;
      }
    },

    series: 
    [
      {
        type: 'graph',
        layout: 'none',
        symbolSize: 70,
        roam: true,
        edgeSymbol: ['circle', 'none'],  
        //后者改为none箭头可消失，改为arrow有箭头
        edgeSymbolSize: [1, 8],
        edgeLabel: {
          normal: {
            textStyle: {
              fontSize: 20
            }
          }
        },
   
      //   force: {
      //       //repulsion: 5500,
            // repulsion: [1,2000],
      //       edgeLength: [1, 500]
      //   },
        
        draggable: true,
        focusNodeAdjacency: true,  //悬浮，与其相关的节点都会highlight

        itemStyle: {
          emphasis: {
            color: '#EAC100'
          }
        },

        lineStyle: {
          normal: {
            width: 0,   //值为0不显示线
            color: '#3C3C3C',
            opacity: 0.4
          },
        },
        
        edgeLabel: {
          normal: {
            show: false,  //显示线上文字
            formatter: function (x) {
              return x.data.name;
            },
            textStyle: {
              fontSize: 13,
            }
          }
        },

        label: {
          normal: {
            show: true,  //换成词云后  这个可以改成false   不显示数字
            textStyle: {
              fontSize: 10
            }
          },
          emphasis:{
            show:false  //****true高亮显示数字编号，正式论文false不显示
            
          }
        },
        data: used_graph_nodes,
        links: used_graph_links,
        emphasis: {
                lineStyle: {
                    width: 5,
                    color: '#080808',
                    opacity:1
                }
            }
      }


    ]
  };
    myChart.setOption(option3);
}
//恢复成原图
function recover(){
  myChart.setOption(option);
}

//深拷贝
function deepClone(obj){
    let objClone = Array.isArray(obj)?[]:{};
    if(obj && typeof obj==="object"){
        for(key in obj){
            if(obj.hasOwnProperty(key)){
                //判断ojb子元素是否为对象，如果是，递归复制
                if(obj[key]&&typeof obj[key] ==="object"){
                    objClone[key] = deepClone(obj[key]);
                }else{
                    //如果不是，简单复制
                    objClone[key] = obj[key];
                }
            }
        }
    }
    return objClone;
}    

//关键词过滤器
function static_num() 
{            
    document.getElementById("btnOperate").onclick = function () {                
        var selected_keyword_arr = [];    

        var items = document.getElementsByName("category");                 
        for (i = 0; i < items.length; i++) {                    
            if (items[i].checked) {                      
               selected_keyword_arr.push(items[i].value.toString().toLowerCase());
            }                
        }
        console.log(selected_keyword_arr);
        if(selected_keyword_arr.length > 0){

            var keyword_length = graph.keywords.length;
            var selected_item = [];
            // console.log(selected_item.length);
            for (i = 0; i < keyword_length; i++){
              var current_keyword = graph.keywords[i].keyword.toLowerCase().split(";");
              // console.log(graph.keywords[i].keyword);
              console.log(i);
              console.log(current_keyword);
              var current_keyword_l = current_keyword.length;
              for(j = 0; j < current_keyword_l; j++){
                  var flag = $.inArray(current_keyword[j],selected_keyword_arr);
                  if(flag != -1){
                    selected_item.push(used_graph_nodes[i]);
                    // console.log(i);
                    break;
                  }
              }
            }
            var len = graph.links.length;
            var new_links = [];
            for(i = 0; i < len; i++){
                var a1 = graph.links[i].source;
                var b1 = graph.links[i].target;
                var len2 = selected_item.length;
                var flag1 = 0;
                var flag2 = 0;
                for(j = 0; j < len2; j++){
                  if(a1 == selected_item[j].keyword){
                    flag1 = 1;
                  }
                  else if(b1 == selected_item[j].keyword){
                    flag2 = 1;
                  }
                }
                if(flag1 == 1 && flag2 == 1){
                  new_links.push(graph.links[i]);
                }
            }
            // console.log(selected_item);
            // var graph_node_len = graph.nodes.length;
            // var graph_node_filter = [];
            // for(i = 0; i < graph_node_len; i++){
            //   var flag = $.inArray(graph.keywords[i].keyword,selected_item);
            //   if(flag == -1){
            //     //delete graph_node_filter[i];
            //     graph_node_filter.push(graph.nodes[i]);
            //   }
            // }
            // console.log(graph_node_filter);
            //alert(graph_node_filter.length);
            //alert(graph.nodes.length);

            option2 = 
              {
    tooltip: {
      formatter: function (x) {
        return x.data.des;
      }
    },

    series: 
    [
      {
        type: 'graph',
        layout: 'none',
        symbolSize: 70,
        roam: true,
        edgeSymbol: ['circle', 'none'],  
        //后者改为none箭头可消失，改为arrow有箭头
        edgeSymbolSize: [1, 8],
        edgeLabel: {
          normal: {
            textStyle: {
              fontSize: 20
            }
          }
        },
   
      //   force: {
      //       //repulsion: 5500,
            // repulsion: [1,2000],
      //       edgeLength: [1, 500]
      //   },
        
        draggable: true,
        focusNodeAdjacency: true,  //悬浮，与其相关的节点都会highlight

        itemStyle: {
          emphasis: {
            color: '#EAC100'
          }
        },

        lineStyle: {
          normal: {
            width: 0,   //值为0不显示线
            color: '#3C3C3C',
            opacity: 0.4
          },
        },
        
        edgeLabel: {
          normal: {
            show: false,  //显示线上文字
            formatter: function (x) {
              return x.data.name;
            },
            textStyle: {
              fontSize: 13,
            }
          }
        },

        label: {
          normal: {
            show: true,  //换成词云后  这个可以改成false   不显示数字
            textStyle: {
              fontSize: 10
            }
          },
          emphasis:{
            show:false  //****true高亮显示数字编号，正式论文false不显示
            
          }
        },
        data: selected_item,
        links: new_links,
        emphasis: {
                lineStyle: {
                    width: 5,
                    color: '#080808',
                    opacity:1
                }
            }
      }


    ]
  };
            used_graph_links = new_links;
            used_graph_nodes = selected_item;
            // console.log(selected_item.length);
            myChart.setOption(option2);
            // alert("选择的个数为：" + selected_keyword_arr.length);   

        }
         
    };        
}; 


if (option && typeof option === "object") {
    myChart.setOption(option, true);
}
    </script>
</body>
</html>
